<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:OutOfTheBox.Controls"
             x:Class="OutOfTheBox.Pages.LoginPage"
             xmlns:vm="clr-namespace:OutOfTheBox.ViewModels"
             x:DataType="vm:LoginViewModel"
             Shell.NavBarIsVisible="False">

    <ScrollView>
        <Grid RowDefinitions="240, Auto, *" RowSpacing="0">

            <!-- En-tÃªte avec image -->
            <Grid Grid.Row="0">
                <Image Source="savane.png" Aspect="AspectFill" />
                <BoxView Background="{StaticResource OverlayGradient}" />
                <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                    <Label Text="NEN" Style="{StaticResource appName}" Margin="0,-8,0,0"/>
                    <Label Text="WOAKA" Style="{StaticResource appName}" />
                </VerticalStackLayout>
            </Grid>

            <!-- Message de bienvenue -->
            <Label Grid.Row="1" 
                   FontFamily="PoppinsRegular"
                   FontSize="18" 
                   HorizontalOptions="Center" 
                   Text="Ravis de vous revoir ðŸ˜Ž"
                   Margin="0,30,0,20"/>
            
            <!-- Formulaire -->
            <VerticalStackLayout Grid.Row="2" Spacing="20" Padding="30,0,30,40">
                
                <VerticalStackLayout Spacing="8">
                    <Label Text="Adresse e-mail" Style="{StaticResource FormLabel}"/>
                    <Border Style="{StaticResource EntryWrapper}">
                        <Grid ColumnDefinitions="Auto, *" VerticalOptions="Center" HeightRequest="50">
                            <Image Source="mail.png" Style="{StaticResource EntryIcon}" />
                            <controls:NoUnderlineEntry Grid.Column="1" Margin="5,5,00,00"
                                                       Placeholder="nom@exemple.com" 
                                                       Text="{Binding Username}" 
                                                       Keyboard="Email" 
                                                       Style="{StaticResource ThemedNoUnderlineEntry}" />
                        </Grid>
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Mot de passe" Style="{StaticResource FormLabel}"/>
                    <Border Style="{StaticResource EntryWrapper}">
                        <Grid ColumnDefinitions="Auto, *, Auto" VerticalOptions="Center" HeightRequest="50">
                            <Image Source="password.png" Style="{StaticResource EntryIcon}" />
                            <controls:NoUnderlineEntry Grid.Column="1" Margin="5,5,00,00" 
                                                       Placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                                                       Text="{Binding Password}" 
                                                       IsPassword="{Binding IsPassword}" 
                                                       Style="{StaticResource ThemedNoUnderlineEntry}" />
                            <ImageButton Grid.Column="2" 
                                         Source="{Binding PasswordIcon}" 
                                         Command="{Binding TogglePasswordVisibilityCommand}" 
                                         Style="{StaticResource EyeIcon}" />
                        </Grid>
                    </Border>
                    <Label Text="Mot de passe oubliÃ© ?" 
                           HorizontalOptions="End" 
                           FontSize="13"
                           TextColor="{StaticResource Primary}"
                           Margin="0,4,0,0"/>
                </VerticalStackLayout>

                <Button Text="Connexion" 
                        Command="{Binding LoginCommand}" 
                        Margin="0,12,0,0" />
                
                <ActivityIndicator IsRunning="{Binding IsLoggingIn}" 
                                   IsVisible="{Binding IsLoggingIn}" 
                                   Color="{StaticResource Primary}"
                                   HorizontalOptions="Center" 
                                   Margin="0,8,0,0"/>

                <Label HorizontalOptions="Center" Margin="0,16,0,0">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Pas encore de compte ? " FontFamily="PoppinsRegular"/>
                            <Span Text="Inscrivez-vous" 
                                  TextColor="{StaticResource Primary}" 
                                  FontFamily="PoppinsBold"
                                  TextDecorations="Underline">
                                <Span.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding NavigationToRegisterpageCommand}"/>
                                </Span.GestureRecognizers>
                            </Span>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </VerticalStackLayout>
        </Grid>
    </ScrollView>
</ContentPage>